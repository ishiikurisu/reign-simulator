<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="/css/master.css">
        <title>Reign Simulator</title>
    </head>

    <body>
        <div id="content">
        </div>

        <script src="/js/wasm_exec.js"></script>
        <script>
            if (!WebAssembly.instantiateStreaming) {
                // polyfill
                WebAssembly.instantiateStreaming = async (resp, importObject) => {
                    const source = await (await resp).arrayBuffer();
                    return await WebAssembly.instantiate(source, importObject);
                };
            }

            const go = new Go();

            let mod, inst;

            WebAssembly.instantiateStreaming(fetch("js/lib.wasm"), go.importObject).then(
                result => {
                    mod = result.module;
                    inst = result.instance;
                }
            );

            async function gorun() {
                await go.run(inst);
                inst = await WebAssembly.instantiate(mod, go.importObject); // reset instance
            }

            function ready(fn) {
                if (document.readyState != 'loading') {
                    fn();
                } else {
                    document.addEventListener('DOMContentLoaded', fn);
                }
            }
        </script>
        <script src="/js/game.js" charset="utf-8"></script>
        <script src="/js/index.js" charset="utf-8"></script>
        <script type="text/javascript">
            ready(main);
        </script>
    </body>
</html>
